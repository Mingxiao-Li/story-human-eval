<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Human Evaluation - Model Comparison</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .prompt-section { margin-bottom: 40px; border-bottom: 1px solid #ccc; padding-bottom: 20px; }
    .prompt-text { font-weight: bold; margin-bottom: 10px; }
    .model-block { margin-bottom: 10px; }
    .model-label { font-weight: bold; margin: 5px 0; }
    .image-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
    img { max-height: 150px; border: 2px solid #ccc; }
    .radio-group { margin: 5px 0; }
    h1, h2 { color: #333; }
    button { padding: 10px 20px; font-size: 16px; }
    pre { background: #eee; padding: 10px; white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>

<h1>Human Evaluation: Model Comparison</h1>
<p>
  For each prompt, review the 4 modelsâ€™ images and select which model performed <strong>best overall</strong> based on:
</p>
<ul>
  <li><strong>Identity Consistency</strong></li>
  <li><strong>Prompt Alignment</strong></li>
  <li><strong>Image Diversity</strong></li>
</ul>

<div id="evaluation-area"></div>

<button onclick="submitResults()">Submit</button>

<h2>Results</h2>
<pre id="result-box"></pre>

<script>
  const numPrompts = 30;
  const numModels = 4;
  const imagesPerModel = 3;

  const prompts = Array.from({ length: numPrompts }, (_, i) => `Prompt ${i + 1}: Describe the scene or object here.`);
  const results = {};
  const modelShuffleMap = {};

  function shuffle(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function render() {
    const container = document.getElementById("evaluation-area");

    prompts.forEach((promptText, pIdx) => {
      const section = document.createElement("div");
      section.className = "prompt-section";

      const pTitle = document.createElement("div");
      pTitle.className = "prompt-text";
      pTitle.textContent = promptText;
      section.appendChild(pTitle);

      const shuffledModels = shuffle([...Array(numModels).keys()]);
      modelShuffleMap[`prompt_${pIdx}`] = shuffledModels;

      shuffledModels.forEach((modelId) => {
        const modelBlock = document.createElement("div");
        modelBlock.className = "model-block";

        const modelLabel = document.createElement("div");
        modelLabel.className = "model-label";
        modelLabel.textContent = `Model ${modelId}`;
        modelBlock.appendChild(modelLabel);

        const imageRow = document.createElement("div");
        imageRow.className = "image-row";

        for (let i = 0; i < imagesPerModel; i++) {
          const img = document.createElement("img");
          img.src = `images/prompt_${pIdx}_model_${modelId}_${i}.jpg`;
          img.alt = `Prompt ${pIdx} - Model ${modelId} - Image ${i}`;
          imageRow.appendChild(img);
        }

        modelBlock.appendChild(imageRow);
        section.appendChild(modelBlock);
      });

      // Single best model selection per prompt
      const label = document.createElement("div");
      label.textContent = "Which model performed best overall for this prompt?";
      label.style.marginTop = "5px";

      const radios = document.createElement("div");
      radios.className = "radio-group";

      shuffledModels.forEach((modelId) => {
        const input = document.createElement("input");
        input.type = "radio";
        input.name = `prompt_${pIdx}_overall`;
        input.value = modelId;
        input.addEventListener("change", () => {
          results[`prompt_${pIdx}`] = modelId;
        });

        radios.appendChild(input);
        radios.appendChild(document.createTextNode(` Model ${modelId} `));
      });

      section.appendChild(label);
      section.appendChild(radios);
      container.appendChild(section);
    });
  }

  function submitResults() {
    const fullResult = {
      timestamp: new Date().toISOString(),
      responses: results,
      model_order: modelShuffleMap,
    };

    document.getElementById("result-box").textContent = JSON.stringify(fullResult, null, 2);

    // Send to Google Apps Script
    fetch("YOUR_GOOGLE_SCRIPT_URL_HERE", {
      method: "POST",
      body: JSON.stringify(fullResult),
      headers: {
        "Content-Type": "application/json"
      }
    })
    .then(res => res.text())
    .then(res => {
      alert("Thank you! Your evaluation was successfully submitted.");
    })
    .catch(err => {
      console.error(err);
      alert("Error submitting. Please try again.");
    });
  }

  render();
</script>

</body>
</html>
